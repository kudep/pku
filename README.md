# ПКУ: Программный комплекс участника конкурса Readable

## Вводные данные

ПКУ предназначен для

-   Расчета метрик и критериев
-   Взаимодействия с платформой в рамках работы квалификационных сессий (алгоритмическая, техническая квалификация)
-   Взаимодействия с платформой в рамках работы финала

## Требования для работы ПКУ

-   [docker](https://docs.docker.com/get-docker/)
-   [docker-compose](https://docs.docker.com/compose/install/) последней версии. (Не менее версии 1.24)
-   [linux окружение](./docs/platform.md) (bash оболочка) на машине, с которой запускается docker
-   Быть зарегистрированным участником на [платформе](https://readable.upgreat.one)

Используйте [рекомендации пост-установки](https://docs.docker.com/engine/install/linux-postinstall/) Docker.

## Начало работы

1. Программный комплекс участника опубликован на github: github.com/upgreat-readable/pku. 

    > При наличии ошибок всегда проверяйте наличие актуальной версии.

2. Корректировка настроек и поднятие сервиса

    Если вы разворачиваете проект в первый раз, скопируйте `.env` файл и внесите туда **токен** который можно взять в [личном кабинете в разделе профиль](https://readable.upgreat.one/lk).

    ```shell script
    # Копируем файл настроек
    cp .env.example .env

    # Скачиваем актуальную версию образа
    docker-compose pull

    # Поднимаем сервис
    docker-compose up -d --force-recreate

    # Проверить что сервис поднят (в случае успеха вы должны увидеть Status в сосстоянии Up)
    docker-compose ps
    ```

3. Начните работу с сервисом

    ```shell script
    # Получение списка команд
    ./pku --help

    # Получение списка параметров конкретной команды
    ./pku commandName --help
    ```

    > примечание: самая актуальная документация - в консоли

## Консольный интерфейс ПКУ

-   [Алгоритмы](./docs/cli-algoritm.md)
-   [Работа с сессиями в рамках квалификаций и финала](./docs/cli-session.md)

## Формат файлов ПКУ

В комплексе используется json формат указанный в [приложении 3 к техническому регламенту](https://ai.upgreat.one/participants/).

### Раздел meta формата расширен следующим параметром

| Наименование поля | Тип данных | Пустое значение                                                              | Соответствие синтаксическим конструкциям языка разметки                               |
| ----------------- | ---------- | ---------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| meta.third        | boolean    | Не допускается. При отсутствии поля в файле, алгоритмы считают равным false. | Признак того что эксперт разметил данные в режиме просмотра предыдущих двух разметок. |

### Рекомендуемый регламент именования файлов

1. Файл без разметки или файл с разметкой участником содержит только id файла.
   Пример: 000105.json

2. Файл разметки экспертов содержит помимо id файла еще и id эксперта
   Пример:

-   000105_exp13.json
-   000105_exp12.json
-   000105_exp55.json

### Структура директории files

-   `/custom` - директория для работы с расчетом метрик и критериев
-   `/in` - директория для входных файлов в рамках сессии
-   `/out` - директория размеченных файлов в рамках сессии

В ближайших версиях появится разделение директорий in/out на вложенные директории сессий.

## Структура пакетов

-   Пакет ПКУ (корень репозитория/папки)
-   Пакет расчет критериев /node_modules/@webpractik/readable_io.criterion
-   Пакет расчет метрик /node_modules/@webpractik/readable_io.psr

## Решение типовых ошибок

### docker-compose pull: permission denied

Если у вас не запускается контейнер, не пулится образ или permission denied, рекомендуем:

1. Проверить что у вас скачана последняя версия docker с официального сайта
2. Проверить что у вас скачана последняя версия docker-compose
3. Проверить что вы выполнили [рекомендации пост-установки Docker](https://docs.docker.com/engine/install/linux-postinstall/) в части работы из под non-root пользователя.

### docker-compose pull: не скачивает образ

При выполнении `docker-compose pull` ничего не происходит

```sh
export $(cat .env | grep READEABLE_PKU)
export $(cat .env | grep TAG)
docker pull $READEABLE_PKU:$TAG
```

## Конфигурация

Параметр настройки логирования в .env файле

```dotenv
# формат логов
LOG_FORMAT=pretty|json

# вывод подробной информации в логах
DEBUG_FLAG=false|true
```

После смены параметров перезапустите контейнер

```shell script
docker-compose up -d --force-recreate
```

## Обратная связь

Если у вас есть предложения - оформляйте **issue** или присылайте **pull request**.
Помимо этого можно присылать предложения на почту [readable@webpractik.ru](mailto:readable@webpractik.ru).

Если это вопрос по работе функционала ПКУ или багрепорт, просьба прикладывать в обращении или issue
1. Версию ПКУ
2. OS
3. Файлы логов которые у вас есть в папке логов
4. Дополнительно по возможности прислать вывод команды docker-compose logs

## Права

Код предназначен для участников конкурса [ПРО//ЧТЕНИЕ](https://ai.upgreat.one/) у которых одобрена заявка на участие в конкурсе.
